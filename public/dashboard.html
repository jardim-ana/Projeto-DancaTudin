<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>DançaTudin - Dashboard</title>

 
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <link rel="stylesheet" href="./css/dashboard.css">

</head>
<body>

 
    <div class="menu">
        <h2>DançaTudin</h2>
        <a href="#">Dashboard</a>
        <a href="#">Perfil</a>
        <a href="#">Locais</a>
        <a href="#">Sair</a>
    </div>

 
    <div class="content">


        <div class="kpi-container">

            <div class="kpi">
                <h3>Pessoas no mesmo nível</h3>
                <p id="kpiNivel">...</p>
            </div>

            <div class="kpi">
                <h3>Nível atual</h3>
                <p id="kpiNivelAtual">...</p>
            </div>

            <div class="kpi">
                <h3>Semanas para subir</h3>
                <p id="kpiSemanas">...</p>
            </div>

        </div>

        <div class="charts">

            <div class="chart-box">
                <h3>Locais que oferecem o nível/estilo</h3>
                <canvas id="graficoPizza"></canvas>
            </div>

            <div class="chart-box">
                <h3>Distribuição de alunos por nível</h3>
                <canvas id="graficoBarras"></canvas>
            </div>

        </div>

    </div>

    <script>

        let idAluno = sessionStorage.ID_ALUNO; 

        function carregarKPIs() {
            fetch(`/medidas/kpis/${idAluno}`)
                .then(r => r.json())
                .then(dados => {
                    document.getElementById("kpiNivel").textContent = dados.pessoasMesmoNivel + " pessoas";
                    document.getElementById("kpiNivelAtual").textContent = dados.nivelAtual;
                    document.getElementById("kpiSemanas").textContent = dados.semanasRestantes + " semanas";
                });
        }



        let pizza;
        let barras;

        function carregarPizza() {
            fetch(`/medidas/distribuicao-zonas/${idAluno}`)
                .then(r => r.json())
                .then(dados => {

                    const labels = dados.map(z => z.zona);
                    const valores = dados.map(z => z.percentual);

                    if (pizza) pizza.destroy();

                    pizza = new Chart(
                        document.getElementById('graficoPizza'),
                        {
                            type: 'pie',
                            data: {
                                labels: labels,
                                datasets: [{
                                    data: valores
                                }]
                            }
                        }
                    );
                });
        }

        function carregarBarras() {
            fetch(`/medidas/distribuicao-niveis/${idAluno}`)
                .then(r => r.json())
                .then(dados => {

                    const labels = dados.map(n => n.nivel);
                    const valores = dados.map(n => n.quantidade);

                    if (barras) barras.destroy();

                    barras = new Chart(
                        document.getElementById('graficoBarras'),
                        {
                            type: 'bar',
                            data: {
                                labels: labels,
                                datasets: [{
                                    data: valores
                                }]
                            },
                            options: {
                                plugins: { legend: { display: false } }
                            }
                        }
                    );
                });
        }

 
        carregarKPIs();
        carregarPizza();
        carregarBarras();

    </script>

</body>
</html>